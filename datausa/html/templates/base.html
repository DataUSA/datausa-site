<!DOCTYPE html>
<html>
  <head>

    <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    {% if self.social_meta() %}
      {% block social_meta %}{% endblock %}
    {% else %}
      {% set meta_desc = "The most comprehensive visualization of U.S. public data. Data USA provides an open, easy-to-use platform that turns data into knowledge." %}
      <meta name="description" content="{{ meta_desc }}">
      <meta property="og:title" content="Data USA" />
      <meta property="og:type" content="article" />
      <meta property="og:image" content="http://{{ request.host }}/static/img/share.jpg" />
      <meta property="og:description" content="{{ meta_desc }}"/>
    {% endif %}
    <meta property="fb:app_id" content="1705281333093640"/>

    <link rel="shortcut icon" type="image/png" href="/static/img/favicon.ico?v={{ g.cache_version }}">

    <!-- Page title block -->
    <title>Data USA{% if self.title() %} | {% endif %}{% block title %}{% endblock %}</title>

    <!-- Load CSS styles -->
    <link type="text/css" rel="stylesheet" media="all" href="/static/css/site.css?v={{ g.cache_version }}" />
    <link type="text/css" rel="stylesheet" media="all" href="/static/css/font-awesome-4.3.0/css/font-awesome.min.css" />

    <!-- Load javascript files -->
    <script src="/static/js/d3.v3.min.js?v={{ g.cache_version }}"></script>
    <script src="/static/js/d3-queue.min.js?v={{ g.cache_version }}"></script>
    <script src="/static/js/d3plus.min.js?v={{ g.cache_version }}"></script>
    <script src="/static/js/topojson.js?v={{ g.cache_version }}"></script>

    {% assets "js" %}
    <script type="text/javascript" src="{{ ASSET_URL }}?v={{ g.cache_version }}"></script>
    {% endassets %}

    <script>

      var resizeFunctions = [],
          resizeInstantFunctions = [],
          scrollFunctions = [],
          cache_version = "{{ g.cache_version }}",
          api = "{{ g.api }}",
          dictionary = {{ g.dictionary|safe }},
          percentages = {{ g.percentages|safe }},
          proportions = {{ g.proportions|safe }},
          per1000 = {{ g.per1000|safe }},
          per10000 = {{ g.per10000|safe }},
          per100000 = {{ g.per100000|safe }},
          affixes = {{ g.affixes|safe }},
          builds = [], current_build;

      for (var key in affixes) {
        if (key in dictionary) affixes[dictionary[key]] = affixes[key];
      }

    </script>

    {% block head %}
    {% endblock %}

  </head>
  <body class="{% if g.page_type %}{{ g.page_type }}{% endif %} {% if g.page_class %}{{ g.page_class }}{% endif %}">

    {% block content %}
    {% endblock %}

    {% block js %}
    {% endblock %}

    <a class="datausa-link hidden" target="_blank" href="https://datausa.io"><img src="/static/img/logo_sm_dark.png" /></a>

    <!-- Google Analytics! -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-70325841-1', 'auto');
      ga('send', 'pageview');
    </script>

    <!-- All Pages -->
    <script type="text/javascript">

      viz.loadBuilds(builds);

      if (resizeFunctions.length || resizeInstantFunctions.length) {

        var resize;

        function resizeEnd() {
          for (var i = 0; i < resizeFunctions.length; i++) {
            resizeFunctions[i]();
          }
        }

        window.onresize = function(){
          for (var i = 0; i < resizeInstantFunctions.length; i++) {
            resizeInstantFunctions[i]();
          }
          clearTimeout(resize);
          resize = setTimeout(resizeEnd, 400);
        }

      }

      var firstScroll = true;
      if (scrollFunctions.length) {
        document.onscroll = function(){
          var wait = firstScroll ? 0 : 500;
          for (var i = 0; i < scrollFunctions.length; i++) {
            scrollFunctions[i](wait);
          }
          firstScroll = false;
        }
      }

      d3.selectAll("[data-tooltip]")
        .on(d3plus.client.pointer.over,function(){

          var tt_id = d3.select(this).attr("data-tooltip-id") || "data-tooltip";

          d3plus.tooltip.remove(tt_id);

          var size = this.getBoundingClientRect();

          var offset = d3.select(this).attr("data-tooltip-offset");
          if (offset) {
            offset = parseFloat(offset);
          }
          else {
            offset = 15;
          }

          var arrow = true;
          if(d3.select(this).attr("data-tooltip-arrow")){
            arrow = d3.select(this).attr("data-tooltip-arrow") === "true";
          }

          d3plus.tooltip.create({
            "x": size.left+size.width/2 + d3plus.client.scroll.x(),
            "y": size.top+size.height/2 + d3plus.client.scroll.y(),
            "offset": size.height/2 + offset,
            "arrow": arrow,
            // "title": "Title",
            "description": d3.select(this).attr("data-tooltip"),
            "width": "auto",
            "id": tt_id,
            "align": d3.select(this).attr("data-tooltip-anchor") || "top center",
            "max_width": 300
          })

        })
        .on(d3plus.client.pointer.out,function(){
          d3plus.tooltip.remove(d3.select(this).attr("data-tooltip-id") || "data-tooltip");
        });

      var compare = {% if compare %}{{ compare|tojson }}{% else %}false{% endif %};
      function addComparison(attr) {

        console.log(attr);

        var name = attr ? attr.display || attr.display_name : "";
        d3.selectAll(".compare-title").text(name);
        d3.selectAll(".compare-separator").style("display", attr ? "inline-block" : "none");
        d3.selectAll(".compare-text").text(attr ? "Remove Comparison" : "Add Comparison");

        if (history.pushState) {
          urlPath = attr ? location.pathname + "?compare=" + attr.id : location.pathname;
          window.history.pushState({path: urlPath}, "", urlPath);
        }

        compare = attr;

      }
      if (compare) addComparison(compare);

      d3.selectAll(".compare-search").on("click", function() {

        d3.event.preventDefault();
        d3.event.stopPropagation();

        if (compare) {
          addComparison(false);
          return;
        }

        var modal = d3.select("#search-compare-modal"),
            rect = d3.select(this).node().getBoundingClientRect();

        if (modal.classed("open")) {
          modal.classed("open", false);
          return;
        }

        modal
          .classed("open", true)
          .style("top", rect.top - parseFloat(modal.style("height"), 10) + window.scrollY - 10 + "px")
          .style("left", rect.left + rect.width / 2 - parseFloat(modal.style("width"), 10) / 2 + "px");

        // focus input
        var search_input = modal.select("input");
        search_input.node().focus();

        // initialize search if input box is empty
        search.container = modal;
        search.click = addComparison;
        search.type = attr_type;
        search.max = 20;
        search.term = search_input.property("value");
        search.reload();

      });

    </script>

    <script>
      window.fbAsyncInit = function() {
        FB.init({
          appId      : '1705281333093640',
          xfbml      : true,
          version    : 'v2.5'
        });
      };

      (function(d, s, id){
         var js, fjs = d.getElementsByTagName(s)[0];
         if (d.getElementById(id)) {return;}
         js = d.createElement(s); js.id = id;
         js.src = "//connect.facebook.net/en_US/sdk.js";
         fjs.parentNode.insertBefore(js, fjs);
       }(document, 'script', 'facebook-jssdk'));
    </script>

  </body>
</html>
